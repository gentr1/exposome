<head>
  <style> body { margin: 0; } </style>

  <script src="three.min.js"></script>
  <script src="OrbitControls.js"></script>
  <script src="three-globe.min.js"></script>
  <script src="d3-7.6.1.min.js"></script>
  <script src="d3-fetch.v1.min.js"></script>
  <!--<script src="../../dist/three-globe.js"></script>-->
</head>

<body>
<div id="globeViz"></div>

<script>
var mydata = [];

  fetch('world-110m.geojson').then(res => res.json()).then(countries =>
  {
	//return fetch('mooc-countries.csv',{ method: 'get',headers: {'content-type': 'text/csv;charset=UTF-8'}}).then(data =>{
	return d3.dsv(',', 'mooc-countries.csv').then(data =>{
	mydata = data
	console.log(mydata)
	
		//d3.csv("mooc-countries.csv", function(error, data) {	
	//mydata = data;
    const Globe = new ThreeGlobe()
      .globeImageUrl('earth-dark.jpg')
      .polygonsData(countries.features.filter(d => d.properties.ISO_A2 !== 'AQ'))
      .polygonCapColor(() => 'rgba(200, 0, 0, 0.7)')
      .polygonSideColor(() => 'rgba(0, 200, 0, 0.1)')
      .polygonStrokeColor(() => '#111');
	  //.polygonStrokeColor(countries.features.filter(function(d) { console.log(d.properties.ISO_A2); return '#1111')})

    setTimeout(() => Globe.polygonAltitude(() => Math.random()), 2000);

    // Setup renderer
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.getElementById('globeViz').appendChild(renderer.domElement);

    // Setup scene
    const scene = new THREE.Scene();
    scene.add(Globe);
    scene.add(new THREE.AmbientLight(0xbbbbbb));
    scene.add(new THREE.DirectionalLight(0xffffff, 0.6));

    // Setup camera
    const camera = new THREE.PerspectiveCamera();
    camera.aspect = window.innerWidth/ window.innerHeight;
    camera.updateProjectionMatrix();
    camera.position.z = 500;

    // Add camera controls
    const tbControls = new THREE.OrbitControls(camera, renderer.domElement);
    tbControls.minDistance = 101;
    tbControls.rotateSpeed = 1;
    tbControls.zoomSpeed = 0.8;
	tbControls.minPolarAngle = Math.PI/4;
	tbControls.maxPolarAngle = Math.PI/2;
	//tbControls.noPan = true;
    // Kick-off renderer
    (function animate() { // IIFE
      // Frame cycle
      tbControls.update();
      renderer.render(scene, camera);
      requestAnimationFrame(animate);
	  
    })();
  //});
  
  });
 });
</script>
</body>